<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindcards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: #f4f4f4;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .button-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            resize: horizontal;
            overflow: auto;
        }
        th {
            background-color: #007BFF;
            color: white;
            border-bottom: 2px solid #0056b3;
        }
        td {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            background-color: #333;
            color: #f4f4f4;
            border: none;
            border-radius: 4px;
        }
        button {
            margin-left: 10px;
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        input[type="file"] {
            margin-left: 10px;
            padding: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        input[type="file"]:hover {
            background-color: #0056b3;
        }
        #stopwatch {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            font-weight: bold;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .prompt-box {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 500px;
        }
        .prompt-description {
            margin-bottom: 15px;
        }
        .title-input-container {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div class="header">
    <h1>Mindcards</h1>
</div>

<div id="stopwatch">00:00:00</div>

<div class="button-container">
    <button onclick="showPrompt()">Add Cards</button>
    <button id="stopwatchButton" onclick="toggleStopwatch()">Start Stopwatch</button>
    <button id="downloadButton" onclick="downloadTXT()">Download</button>
</div>

<table id="mindcardTable">
    <thead>
        <tr>
            <th>Question Type</th>
            <th>Keyword</th>
            <th>Answer</th>
            <th>Your Answer</th>
            <th></th>
        </tr>
    </thead>
    <tbody id="tableBody">
    </tbody>
</table>

<script>
    const tableBody = document.getElementById("tableBody");
    const stopwatch = document.getElementById("stopwatch");
    const stopwatchButton = document.getElementById("stopwatchButton");
    const downloadButton = document.getElementById("downloadButton");
    let stopwatchInterval;
    let stopwatchRunning = false;
    let stopwatchStarted = false;

    const questionTypes = ["Reason", "Method", "Definition", "Example", "Application"];

    function addRow(questionType = "", keyword = "", answer = "", yourAnswer = "", afterRow = null) {
        const newRow = document.createElement("tr");

        const questionTypeCell = document.createElement("td");
        const keywordCell = document.createElement("td");
        const answerCell = document.createElement("td");
        const yourAnswerCell = document.createElement("td");
        const actionCell = document.createElement("td");

        const questionTypeInput = document.createElement("input");
        questionTypeInput.type = "text";
        questionTypeInput.value = questionType;
        questionTypeInput.placeholder = "Enter question type";
        questionTypeInput.disabled = stopwatchRunning;
        questionTypeCell.appendChild(questionTypeInput);

        const keywordInput = document.createElement("input");
        keywordInput.type = "text";
        keywordInput.value = keyword;
        keywordInput.disabled = stopwatchRunning;
        keywordCell.appendChild(keywordInput);

        const answerInput = document.createElement("input");
        answerInput.type = "text";
        answerInput.value = answer;
        answerInput.disabled = stopwatchRunning;
        answerInput.style.display = stopwatchRunning ? "none" : "block";
        answerCell.appendChild(answerInput);

        const yourAnswerInput = document.createElement("input");
        yourAnswerInput.type = "text";
        yourAnswerInput.value = yourAnswer;
        yourAnswerInput.readOnly = !stopwatchRunning;
        yourAnswerInput.style.display = (!stopwatchStarted) ? "none" : "block";
        yourAnswerCell.appendChild(yourAnswerInput);

        if (!stopwatchRunning) {
            const addButton = document.createElement("button");
            addButton.textContent = "+";
            addButton.onclick = () => duplicateRow(newRow);
            actionCell.appendChild(addButton);

            const deleteButton = document.createElement("button");
            deleteButton.textContent = "🗑️";
            deleteButton.onclick = () => deleteRow(newRow);
            actionCell.appendChild(deleteButton);
        }

        newRow.appendChild(questionTypeCell);
        newRow.appendChild(keywordCell);
        newRow.appendChild(answerCell);
        newRow.appendChild(yourAnswerCell);
        newRow.appendChild(actionCell);

        if (afterRow) {
            afterRow.parentNode.insertBefore(newRow, afterRow.nextSibling);
        } else {
            tableBody.appendChild(newRow);
        }
    }

    function duplicateRow(row) {
        const cells = row.getElementsByTagName("td");
        addRow(
            cells[0].firstChild.value,
            cells[1].firstChild.value,
            cells[2].firstChild.value,
            cells[3].firstChild.value,
            row
        );
    }

    function deleteRow(row) {
        tableBody.removeChild(row);
    }

    function toggleStopwatch() {
        if (!stopwatchRunning) {
            startStopwatch();
        } else {
            resetStopwatch();
        }
    }

    function startStopwatch() {
        if (!stopwatchStarted) {
            stopwatchStarted = true;
            stopwatch.style.display = "block";
        }
        stopwatchRunning = true;
        toggleTableInputs();
        stopwatchButton.textContent = "Reset Stopwatch";
        downloadButton.style.display = "none";
        startTimer();
    }

    function resetStopwatch() {
        stopwatchRunning = false;
        toggleTableInputs();
        clearInterval(stopwatchInterval);
        stopwatch.textContent = "00:00:00";
        stopwatchButton.textContent = "Start Stopwatch";
        downloadButton.style.display = "inline-block";
    }

    function toggleTableInputs() {
        const rows = tableBody.getElementsByTagName("tr");
        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName("td");
            const questionTypeInput = cells[0].firstChild;
            const keywordInput = cells[1].firstChild;
            const answerInput = cells[2].firstChild;
            const yourAnswerInput = cells[3].firstChild;
            const actionCell = cells[4];

            questionTypeInput.disabled = stopwatchRunning;
            keywordInput.disabled = stopwatchRunning;
            yourAnswerInput.readOnly = !stopwatchRunning;
            yourAnswerInput.style.display = (!stopwatchStarted) ? "none" : "block";
            answerInput.style.display = stopwatchRunning ? "none" : "block";
            actionCell.style.display = stopwatchRunning ? "none" : "block";
        }
    }

    function startTimer() {
        let seconds = 0;
        let minutes = 0;
        let hours = 0;

        stopwatchInterval = setInterval(() => {
            seconds++;
            if (seconds === 60) {
                seconds = 0;
                minutes++;
            }
            if (minutes === 60) {
                minutes = 0;
                hours++;
            }

            const displaySeconds = seconds < 10 ? `0${seconds}` : seconds;
            const displayMinutes = minutes < 10 ? `0${minutes}` : minutes;
            const displayHours = hours < 10 ? `0${hours}` : hours;

            stopwatch.textContent = `${displayHours}:${displayMinutes}:${displaySeconds}`;
        }, 1000);
    }

    function showPrompt() {
        const overlay = document.createElement('div');
        overlay.className = 'overlay';
        overlay.innerHTML = `
            <div class="prompt-box">
                <div class="prompt-description">
                    Enter paragraph titles. Cards will be created for each title with all question types.
                </div>
                <div id="titleInputs">
                    <div class="title-input-container">
                        <input type="text" class="titleInput" placeholder="Enter paragraph title">
                    </div>
                </div>
                <button onclick="addTitleInput()">Add More Titles</button>
                <button onclick="createCards()">Create Cards</button>
                <button onclick="importCards()">Import Cards</button>
            </div>
        `;
        document.body.appendChild(overlay);
    }

    function addTitleInput() {
        const titleInputs = document.getElementById('titleInputs');
        const newInput = document.createElement('div');
        newInput.className = 'title-input-container';
        newInput.innerHTML = '<input type="text" class="titleInput" placeholder="Enter paragraph title">';
        titleInputs.appendChild(newInput);
    }

    function createCards() {
        const titleInputs = document.querySelectorAll('.titleInput');
        titleInputs.forEach(input => {
            const title = input.value.trim();
            if (title) {
                questionTypes.forEach(questionType => {
                    addRow(questionType, title, "", "");
                });
            }
        });

        const overlay = document.querySelector('.overlay');
        if (overlay) {
            document.body.removeChild(overlay);
        }
    }

    function importCards() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.txt';
        input.onchange = function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result.trim();
                    const rows = content.split(/\n\s*\n/);
                    
                    rows.forEach(row => {
                        const lines = row.split("\n");

                        if (lines.length === 4) {
                            const questionTypeLine = lines[0].replace('Question Type: ', '').trim();
                            const keywordLine = lines[1].replace('Keyword: ', '').trim();
                            const answerLine = lines[2].replace('Answer: ', '').trim();
                            const yourAnswerLine = lines[3].replace('Your Answer: ', '').trim();

                            addRow(questionTypeLine, keywordLine, answerLine, yourAnswerLine);
                        }
                    });

                    const overlay = document.querySelector('.overlay');
                    if (overlay) {
                        document.body.removeChild(overlay);
                    }
                };
                reader.readAsText(file);
            }
        };
        input.click();
    }

    function downloadTXT() {
        const rows = tableBody.getElementsByTagName("tr");
        let content = "";

        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName("td");
            const questionType = cells[0].firstChild.value;
            const keyword = cells[1].firstChild.value;
            const answer = cells[2].firstChild.value;
            const yourAnswer = cells[3].firstChild.value;

            content += `Question Type: ${questionType} \nKeyword: ${keyword} \nAnswer: ${answer} \nYour Answer: ${yourAnswer}\n \n`;
        }

        const blob = new Blob([content], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "mindcards.txt";
        a.click();
        URL.revokeObjectURL(url);
    }

    // Show prompt immediately when the page loads
    window.onload = showPrompt;
</script>
</body>
</html>
