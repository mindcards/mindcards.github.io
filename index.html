<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindcards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: #f4f4f4;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .button-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #007BFF;
            color: white;
            border-bottom: 2px solid #0056b3;
        }
        td {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            background-color: #333;
            color: #f4f4f4;
            border: none;
            border-radius: 4px;
        }
        button {
            margin-left: 10px;
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        input[type="file"] {
            margin-left: 10px;
            padding: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        input[type="file"]:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<div class="header">
    <h1>Mindcards</h1>
</div>

<div class="button-container">
    <input type="text" id="textInput" placeholder="Enter text to automatically create mindcards.">
    <button onclick="addRowsWithText()">Add Mindcards</button>
    <button id="startTimerButton" onclick="startStopwatch()">Start Stopwatch</button>
    <button id="stopTimerButton" onclick="pauseStopwatch()" style="display: none;">Pause Stopwatch</button>
    <button onclick="downloadTXT()">Download</button>
    <input type="file" id="importFile" accept=".txt" onchange="importTXT()">
</div>

<table id="mindcardTable">
    <thead>
        <tr>
            <th>Question Type</th>
            <th>Keyword</th>
            <th>Answer</th>
            <th>Your Answer</th>
            <th></th>
        </tr>
    </thead>
    <tbody id="tableBody">
    </tbody>
</table>

<div id="stopwatch" style="display: none;">00:00:00</div>
<div id="stopwatchControls" style="display: none;">
    <!--<button onclick="pauseStopwatch()">Pause</button>-->
    <button onclick="resetStopwatch()">Reset</button>
</div>

<script>
    const tableBody = document.getElementById("tableBody");
    const stopwatch = document.getElementById("stopwatch");
    const stopwatchControls = document.getElementById("stopwatchControls");
    let stopwatchInterval;
    let stopwatchRunning = false;
    let stopwatchStarted = false;

    const questionTypes = ["Reason", "Method", "Definition", "Example", "Application"];

    function addRow(questionType = "", keyword = "", answer = "", yourAnswer = "") {
        const newRow = document.createElement("tr");

        const questionTypeCell = document.createElement("td");
        const keywordCell = document.createElement("td");
        const answerCell = document.createElement("td");
        const yourAnswerCell = document.createElement("td");
        const actionCell = document.createElement("td");

        const questionTypeSelect = document.createElement("select");
        questionTypes.forEach(type => {
            const option = document.createElement("option");
            option.value = type;
            option.textContent = type;
            questionTypeSelect.appendChild(option);
        });
        questionTypeSelect.value = questionType;
        questionTypeSelect.disabled = stopwatchRunning;
        questionTypeCell.appendChild(questionTypeSelect);

        const keywordInput = document.createElement("input");
        keywordInput.type = "text";
        keywordInput.value = keyword;
        keywordInput.disabled = stopwatchRunning;
        keywordCell.appendChild(keywordInput);

        const answerInput = document.createElement("input");
        answerInput.type = "text";
        answerInput.value = answer;
        answerInput.disabled = stopwatchRunning;
        answerInput.style.display = stopwatchRunning ? "none" : "block";
        answerCell.appendChild(answerInput);

        const yourAnswerInput = document.createElement("input");
        yourAnswerInput.type = "text";
        yourAnswerInput.value = yourAnswer;
        yourAnswerInput.readOnly = !stopwatchRunning;
        yourAnswerInput.style.display = (!stopwatchStarted) ? "none" : "block";
        yourAnswerCell.appendChild(yourAnswerInput);

        if (!stopwatchRunning) {
            const addButton = document.createElement("button");
            addButton.textContent = "+";
            addButton.onclick = () => duplicateRow(newRow);
            actionCell.appendChild(addButton);

            const deleteButton = document.createElement("button");
            deleteButton.textContent = "ðŸ—‘ï¸";
            deleteButton.onclick = () => deleteRow(newRow);
            actionCell.appendChild(deleteButton);
        }

        newRow.appendChild(questionTypeCell);
        newRow.appendChild(keywordCell);
        newRow.appendChild(answerCell);
        newRow.appendChild(yourAnswerCell);
        newRow.appendChild(actionCell);
        tableBody.appendChild(newRow);
    }

    function duplicateRow(row) {
        const cells = row.getElementsByTagName("td");
        addRow(
            cells[0].firstChild.value,
            cells[1].firstChild.value,
            cells[2].firstChild.value,
            cells[3].firstChild.value
        );
    }

    function deleteRow(row) {
        tableBody.removeChild(row);
    }

    function startStopwatch() {
        if (!stopwatchStarted) {
            stopwatchStarted = true;
            stopwatch.style.display = "block";
            stopwatchControls.style.display = "block";
        }
        stopwatchRunning = true;
        toggleTableInputs();
        document.getElementById("startTimerButton").style.display = "none";
        document.getElementById("stopTimerButton").style.display = "inline-block";
        startTimer();
    }

    function pauseStopwatch() {
        stopwatchRunning = false;
        toggleTableInputs();
        clearInterval(stopwatchInterval);
        document.getElementById("startTimerButton").style.display = "inline-block";
        document.getElementById("stopTimerButton").style.display = "none";
    }

    function resetStopwatch() {
        stopwatchRunning = false;
        toggleTableInputs();
        clearInterval(stopwatchInterval);
        stopwatch.textContent = "00:00:00";
        document.getElementById("startTimerButton").style.display = "inline-block";
        document.getElementById("stopTimerButton").style.display = "none";
    }

    function toggleTableInputs() {
        const rows = tableBody.getElementsByTagName("tr");
        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName("td");
            const questionTypeSelect = cells[0].firstChild;
            const keywordInput = cells[1].firstChild;
            const answerInput = cells[2].firstChild;
            const yourAnswerInput = cells[3].firstChild;
            const actionCell = cells[4];

            questionTypeSelect.disabled = stopwatchRunning;
            keywordInput.disabled = stopwatchRunning;
            yourAnswerInput.readOnly = !stopwatchRunning;
            yourAnswerInput.style.display = (!stopwatchStarted) ? "none" : "block";
            answerInput.style.display = stopwatchRunning ? "none" : "block";
            actionCell.style.display = stopwatchRunning ? "none" : "block";
        }
    }

    function startTimer() {
        let seconds = 0;
        let minutes = 0;
        let hours = 0;

        stopwatchInterval = setInterval(() => {
            seconds++;
            if (seconds === 60) {
                seconds = 0;
                minutes++;
            }
            if (minutes === 60) {
                minutes = 0;
                hours++;
            }

            const displaySeconds = seconds < 10 ? `0${seconds}` : seconds;
            const displayMinutes = minutes < 10 ? `0${minutes}` : minutes;
            const displayHours = hours < 10 ? `0${hours}` : hours;

            stopwatch.textContent = `${displayHours}:${displayMinutes}:${displaySeconds}`;
        }, 1000);
    }

    function addRowsWithText() {
        const textInput = document.getElementById("textInput").value;
        if (!textInput) return;

        const sentences = textInput.match(/[^\.!\?]+[\.!\?]+/g);
        if (sentences) {
            sentences.forEach(sentence => {
                const [firstWord, secondWord] = sentence.trim().split(/\s+/);
                const keyword = [firstWord, secondWord].join(" ");

                // Create a row with the text split into Question Type, Keyword, Answer
                addRow(
                    "", // Default Question Type
                    keyword,
                    sentence.trim(),
                    ""
                );
            });
        }
    }

    function downloadTXT() {
        // Get all table rows from the table body
        const rows = tableBody.getElementsByTagName("tr");
        
        // Initialize an empty string to accumulate the text content
        let content = "";

        // Loop through each row in the table
        for (let i = 0; i < rows.length; i++) {
            // Get all cells in the current row
            const cells = rows[i].getElementsByTagName("td");

            // Extract the value from each cell's first child (input element)
            const questionType = cells[0].firstChild.value; // Get the question type from the first column
            const keyword = cells[1].firstChild.value; // Get the keyword from the second column
            const answer = cells[2].firstChild.value; // Get the answer from the third column
            const yourAnswer = cells[3].firstChild.value; // Get the user's answer from the fourth column

            // Append the extracted values to the content string in the desired format
            content += `Question Type: ${questionType} \nKeyword: ${keyword} \nAnswer: ${answer} \nYour Answer: ${yourAnswer}\n \n`;
        }

        // Create a Blob object with the content string, specifying the MIME type as plain text
        const blob = new Blob([content], { type: "text/plain" });

        // Create a URL for the Blob object
        const url = URL.createObjectURL(blob);

        // Create a temporary anchor element for downloading the file
        const a = document.createElement("a");
        a.href = url; // Set the href attribute to the Blob URL
        a.download = "mindcards.txt"; // Set the file name for the download
        a.click(); // Programmatically click the anchor to trigger the download

        // Revoke the Blob URL to release memory
        URL.revokeObjectURL(url);
    }

    function importTXT() {
        // Get the selected file from the file input element
        const file = document.getElementById("importFile").files[0];
        // If no file is selected, exit the function
        if (!file) return;

        // Create a FileReader object to read the file content
        const reader = new FileReader();
        
        // Define the onload event handler for the FileReader
        reader.onload = function(e) {
            // Get the content of the file from the event object
            const content = e.target.result.trim();

            // Split the content into rows based on double new lines (each row representing one card)
            const rows = content.split(/\n\s*\n/); // Adjusted regex to split by blank lines
            
            // Iterate through each row to parse and add the data
            rows.forEach(row => {
                // Split each row into individual lines
                const lines = row.split("\n");

                // Ensure there are exactly 4 lines for a complete record
                if (lines.length === 4) {
                    // Extract and clean up each line's content
                    const questionTypeLine = lines[0].replace('Question Type: ', '').trim();
                    const keywordLine = lines[1].replace('Keyword: ', '').trim();
                    const answerLine = lines[2].replace('Answer: ', '').trim();
                    const yourAnswerLine = lines[3].replace('Your Answer: ', '').trim();

                    // Add a new row to the table with the extracted data
                    addRow(questionTypeLine, keywordLine, answerLine, yourAnswerLine);
                }
            });
        };
        
        // Read the file as text
        reader.readAsText(file);
    }
</script>
</body>
</html>
